App search & browse feature:
- New reusable AppSearchBar component (components/app-search-bar.tsx) with 3 modes: follow, competitor, browse-only
- Search results show app icon, name (clickable Link to /apps/{slug}), rating/reviews, and status badges (Following/Competitor/This app)
- + button action depends on mode: follow mode adds as my app, competitor mode adds as competitor
- + button has title tooltip on hover explaining the action
- Browse (clicking app name) available to all roles; action buttons only for owner/editor
- Replaced duplicated inline search code in /apps/page.tsx and competitors-section.tsx
- Added search to homepage (My Apps card: follow mode, Competitor Apps card: browse-only)
- Added search to /competitors page (browse-only mode)
- API: added iconUrl to GET /api/apps/search response

Settings page profile edit & direct user creation notes:

- PATCH /api/auth/me extended: name, email (uniqueness check), password change (current password verification)
- POST /api/account/members added: owner-only direct user creation (email, name, password, role)
- JWT email update: no re-issuing needed, next token refresh (15min) picks up new email
- Invitation API routes kept for backward compatibility, just not used from dashboard anymore
- bcrypt imported in account.ts for password hashing in user creation

Scraping depth documentation:
- Created files/SCRAPING-DEPTH.md documenting all cron job schedules, pagination limits, stop conditions, cascade behavior, rate limiting, and data flow

Dashboard table links & competitors self-row:
- Overview and /apps pages: table cells (Reviews, Competitors, Keywords, Ranked, Last Change) now link to their respective detail pages
- /apps/[slug]/competitors: tracked app itself shown at top with green highlight (border-l-emerald-500 bg-emerald-500/10)
- API: GET /api/account/tracked-apps/:slug/competitors?includeSelf=true prepends self app with isSelf flag
- Self row excluded from reorder/delete actions, always pinned to top when sorting
- Migration startup wrapped in try-catch for idempotent restarts
- SCRAPING-DEPTH.md updated with keyword suggestion details (storage, cascade scoping)

Developer page table enrichment:
- /api/apps/by-developer now returns isBuiltForShopify, launchedDate, minPaidPrice (computed from pricingPlans)
- Developer page table matches /apps page: sortable columns, BFS badge, linked Reviews/Min. Paid/Last Change cells, Categories with ranking, Launched date
- Batch-fetches categories and last-changes in parallel after loading apps

Compare page keyword density & test mode:
- Added KeywordDensityTable component with stop word filtering, grouped by count (only count > 1)
- useKeywordDensity hook: tokenizes text, filters stop words, groups keywords by frequency, calculates density %
- App Details section now uses side-by-side layout (text left, keyword density table right)
- Collapsible "Test a new description" panel: textarea with CharBadge, Analyze/Clear buttons
- When analyzed, shows draft text + keyword density table in grid-cols-2 layout

Review velocity & acceleration metrics:
- New DB table: app_review_metrics (v7d, v30d, v90d, accMicro, accMacro, momentum)
- Computation job counts reviews from reviews table (COUNT FILTER WHERE review_date >= N days ago)
- Review scraper updated: sort_by=newest, 90-day cutoff, max 50 pages
- Reviews worker auto-triggers metrics computation after scraping (no separate cron needed)
- API: POST /api/apps/review-velocity bulk endpoint, competitors endpoints enriched
- Dashboard: R7d, R30d, R90d, Momentum columns on competitors page, per-app competitors, app-list-table
- MomentumBadge component with emoji states (Accelerating/Stable/Slowing/Spike/Flat)
- Instant tooltips on table headers using Radix UI Tooltip (delayDuration=0)
- Admin can still manually trigger compute_review_metrics from scraper page

Competitors page enhancements (pin, rank change, avg sort, percentile):
- Pin toggle for self app: Pin/PinOff icon in # column, toggles sticky-at-top vs sorted naturally
- State persisted in localStorage per appSlug (competitors-pin-self-{appSlug})
- Category rank change: API query enhanced with LAG() window function to get prev_position
- Displayed as (#5 (+2)) in green for improvement, red for drops
- Cat. Rank sorting changed from best (min) rank to average rank across all categories
- Category percentile: API enhanced with LEFT JOIN LATERAL to category_snapshots for app_count
- Displayed as "Top X%" with tooltip showing "Rank N of M apps"
- Single combined SQL query serves both rank change and percentile (no extra round trips)

Competitors table UI polish & column visibility:
- Column visibility toggle: Settings2 icon button next to search bar opens Radix DropdownMenu
- 15 toggleable columns (Rating through Last Change); #, App, Action always visible
- Hidden columns persisted in localStorage per appSlug (competitors-columns-{appSlug})
- Show all / Hide all bulk actions at top of dropdown
- Badge on settings icon shows count of hidden columns
- Scrollable dropdown list (max-h-300px) with tooltips on non-obvious column names
- Hiding sorted column resets sort to default order
- MomentumBadge: icon stacked above label (flex-col), Category Rank header expanded from "Cat. Rank"
- Pricing column abbreviated with tooltip, Shopify external link per row, frozen #/App columns

Category ad sightings — historical tracking:
- New DB table: category_ad_sightings (appSlug, categorySlug, seenDate, timesSeenInDay, firstSeenRunId, lastSeenRunId)
- Unique index on (appSlug, categorySlug, seenDate) with upsert-on-conflict for timesSeenInDay increment
- Category scraper: recordCategoryAdSightings() called for every page (first + additional), filters is_sponsored apps
- API: GET /api/apps/:slug/category-ad-sightings and GET /api/categories/:slug/ads endpoints
- Dashboard: App Ads page split into "Keyword Ad History" + "Category Ad History" cards
- Dashboard: Category page gets "Sponsored Apps" heatmap section with empty state
- CLI: categories command now accepts optional slug for single-category scrape

App similarity scores — multi-dimensional scoring:
- New DB table: app_similarity_scores (appSlugA, appSlugB, overallScore, categoryScore, featureScore, keywordScore, textScore, computedAt)
- Canonical ordering: appSlugA < appSlugB, unique index on (appSlugA, appSlugB)
- Jaccard index for each dimension: category slug overlap, feature_handle overlap, keyword ranking overlap, tokenized text overlap
- Text similarity: name + subtitle + appIntroduction, tokenized with stop words removed (English + Shopify-specific)
- Weighted average: 25% each for category, feature, keyword, text
- Pre-computed via compute_similarity_scores job (same pattern as compute_review_metrics)
- Job collects all unique (trackedApp, competitor) pairs across accounts, batch-fetches data, computes in memory
- API: competitors endpoint enriched with similarityScore { overall, category, feature, keyword, text }
- Dashboard: Similarity column on competitors table with progress bar + percentage, color-coded (red >=70%, amber 40-69%, green <40%)
- Tooltip shows 4 component breakdowns, sortable, toggleable column
- Admin scraper page: manual trigger for compute_similarity_scores job

Unit test infrastructure & pre-commit hooks:
- Vitest + @testing-library/react + @testing-library/jest-dom + @testing-library/user-event + jsdom
- 510 tests across 39 test files covering all pages, components, lib functions, API, proxy routing, auth, system admin, scraper, settings, invitation
- Test categories: lib utilities (cn, format-date, tag-colors, analytics), auth context, UI components (confirm-modal, pagination, velocity, momentum, keyword-tag, skeletons, sidebar, star-buttons), landing page components (hero, features, problem, how-it-works, differentiators, CTA, footer, header), auth pages (login, register, invitation accept), legal pages (terms, privacy), system admin pages (dashboard, users list, user detail, accounts list, account detail, scraper management, apps list, keywords list, packages, features list), settings page, API functions (47 tests), proxy routing (22 tests)
- Husky v9 pre-commit hook: runs ESLint (blocks on errors) + Vitest (blocks on test failures)
- ESLint 9 flat config: React Compiler rules + TypeScript strict rules downgraded to warnings
- Global test setup mocks: next/navigation, next/link, next/headers, radix-ui (Slot + VisuallyHidden), IntersectionObserver, ResizeObserver, matchMedia
- Test utils: mock user/admin/viewer objects, mock account, setupAuthMock helper for per-test auth overrides

Keyword grouping (PLA-11):
- Pure frontend feature, no API/DB changes
- New utility: lib/keyword-word-groups.ts — extractWordGroups() splits keywords into words, counts frequency (min 2), filters stop words (a/the/for/app/apps etc.), returns sorted by count desc then alphabetically
- filterKeywordsByWord() uses whole-word matching (not substring) to avoid "ai" matching "email"
- Words deduplicated within a single keyword, case-insensitive, min 2 chars
- New component: KeywordWordGroupFilter — visually distinct from tags: dashed border, rounded-md (not pill), monochrome (no colors), count badge suffix, "Common words:" label
- Single-select toggle (vs tags' multi-select), AND logic with tag filter
- Word groups computed from full keyword list (not filtered), so buttons stay stable when tag filter is active
- useEffect clears activeWordFilter if the word disappears from wordGroups after keyword add/remove
- 26 new tests (18 utility + 8 component)

Keyword suggestions from app metadata (PLA-10):
- New shared utility: packages/shared/src/keyword-extraction.ts — pure function, no DB dependency
- N-gram generation: unigrams (4+ chars, not stop word), bigrams (1+ non-stop), trigrams (2+ non-stop)
- 7 weighted fields: name(10), subtitle(5), introduction(4), categories(3), features(2), description(2), categoryFeatures(2)
- Word count multiplier: 1-word=1x, 2-word=2x, 3-word=3x boosts multi-word keywords
- Filters: must appear in primary field (name/subtitle/intro/description), min 2 fields, max 3 words
- Scores accumulate across fields — same keyword in name(10) + subtitle(5) = 15
- Stop words: common English + Shopify-specific (app, store, tool, solution, powerful, easy, etc.)
- API: GET /api/account/tracked-apps/:slug/keyword-suggestions?debug=true&limit=100
- API returns tracked:boolean per keyword (no longer filtered out, shown as "Added" in UI)
- Computed on-demand (not pre-stored), 4 simple indexed queries + in-memory scoring
- Dashboard component: MetadataKeywordSuggestions with prominent/normal modes
- Prominent mode (empty state): auto-opens, larger CTA button, integrated into keywords empty state
- Normal mode: collapsible "Suggest keywords" outline button above keyword table
- UI shows: keyword, source field badges, count × score, Shopify search link, Add/Added state
- Weight legend footer for algorithm transparency during iteration
- 35 new tests (24 extraction algorithm + 11 component)

Keyword loading states & polling (PLA-13):
- When a new keyword is added with scraperEnqueued:true, its keywordId is tracked in pendingKeywordIds Set
- Polling: useEffect with setInterval (5s) fetches keywords when pendingKeywordIds is non-empty
- When a pending keyword gets latestSnapshot !== null, it moves to resolvedKeywordIds for animation
- Pending state: Skeleton pulse in ranking cells + Skeleton + Loader2 spinner in Total Results cell
- New row: animate-in fade-in slide-in-from-top CSS animation on the TableRow
- Resolved state: animate-in fade-in duration-700 on ranking and results cells (2s auto-clear)
- No API changes — uses existing keywordId, scraperEnqueued, latestSnapshot fields
- onKeywordAdded callback signature changed to (keywordId?, scraperEnqueued?) across MetadataKeywordSuggestions and KeywordSuggestionsModal
- Both suggestion components now parse POST response and forward keywordId/scraperEnqueued to parent

Competitor loading states & polling (PLA-15):
- Same pattern as PLA-13 keywords, applied to competitors page (/apps/[slug]/competitors)
- API: POST competitor endpoint always returns scraperEnqueued=true (enqueues scrape pipeline)
  - Unlike keywords, competitor apps often already have a basic snapshot from search
  - The scrape pipeline (app_details → reviews → compute_review_metrics → compute_similarity_scores) produces enriched data
- Frontend: pendingCompetitorSlugs Map<string, number> (slug → addedAt timestamp) + resolvedCompetitorSlugs Set
- loadCompetitors() accepts silent=true param to skip full table skeleton
- addCompetitor() uses silent load + tracks pending slug when scraperEnqueued=true
- Polling: 5s interval when pendingCompetitorSlugs is non-empty, refreshes competitors + last changes
- Resolution: when reviewVelocity !== null OR similarityScore !== null (enriched data from compute jobs)
  - 120s timeout fallback for edge cases where compute jobs don't produce output
- Skeleton shown only on compute-job cells (similarity, v7d/v30d/v90d, momentum)
- Already-available cells (rating, reviews, pricing, featured, etc.) show actual data immediately
- Loader2 spinner next to app name while pending
- Resolved cells: animate-in fade-in duration-700 animation (2s auto-clear)
- New row: animate-in fade-in slide-in-from-top on the TableRow
- Files changed: account.ts (API), competitors-section.tsx (dashboard)

Keyword alphabetical sorting (PLA-16):
- "Keyword" table header in keywords-section.tsx is now clickable to sort alphabetically
- Uses sortBySlug === "_alpha" as a special value (distinct from app slugs used for ranking sort)
- localeCompare for proper alphabetical ordering
- ArrowDown indicator shows when alphabetical sort is active
- Clicking any app icon column switches back to ranking sort for that app

Worker re-structure — dual queue architecture (PLA-14):
- Problem: single BullMQ queue (scraper-jobs) with concurrency=1 meant user-triggered jobs waited behind long-running scheduled jobs
- Solution: two separate queues with dedicated workers in separate containers
  - scraper-jobs-interactive: processes user-triggered jobs (track app, track keyword, add competitor) with no rate limiter
  - scraper-jobs-background: processes scheduled/cron jobs, cascade jobs, admin triggers with rate limiter (1 job/5s)
- Shared job processor: process-job.ts extracted from worker.ts, both workers import the same processJob function
- API routing: account.ts routes → interactive queue, scheduler/admin → background queue
- Cascade jobs always go to background queue (not user-blocking)
- System admin scraper page shows per-queue breakdown (interactive/background) with combined totals
- Queue management endpoints (pause/resume/drain/clear) operate on both queues
- Trigger endpoint accepts optional queue parameter (default: background)
- Docker: same Dockerfile.worker image, two services in docker-compose (worker + worker-interactive)
- Files: queue.ts, process-job.ts (new), worker.ts, interactive-worker.ts (new), account.ts, system-admin.ts, admin.ts, scraper page, docker-compose.prod.yml, package.json

Queue tracking in scrape_runs (PLA-17):
- New DB column: scrape_runs.queue (varchar(20), nullable for backward compat)
- Migration: 0036_scrape_runs_queue.sql — simple ALTER TABLE ADD COLUMN
- createProcessJob() accepts queueName parameter, workers pass "background" or "interactive"
- All scrape_run inserts include queue: category-scraper (crawl, scrapeSingle), app-details-scraper (scrapeTracked, scrapeApp), review-scraper (scrapeTracked), keyword-scraper (scrapeAll), keyword-suggestion-scraper (scrapeAll), compute-review-metrics, compute-similarity-scores, process-job inline inserts (keyword_search single, keyword_suggestions single, reviews single)
- API: GET /api/system-admin/scraper/runs now supports ?queue=interactive|background filter
- Dashboard Run History table: new "Queue" column with badge (interactive/background), queue filter dropdown alongside type/trigger filters
- Existing runs have queue=null (shown as dash in UI)
- Files: scrape-runs.ts, 0036_scrape_runs_queue.sql, process-job.ts, worker.ts, interactive-worker.ts, category-scraper.ts, app-details-scraper.ts, review-scraper.ts, keyword-scraper.ts, keyword-suggestion-scraper.ts, compute-review-metrics.ts, compute-similarity-scores.ts, system-admin.ts (API), scraper/page.tsx, scraper-page.test.tsx
